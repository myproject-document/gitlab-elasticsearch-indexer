.test-default: &test-default
  variables:
    V: "1"
    ELASTIC_CONNECTION_INFO: '{"url":["http://elasticsearch:9200"]}'
  stage: test
  script:
    - apt-get update && apt-get -yy install libicu-dev
    - make setup
    - make format
    - make cover
    - make
    - make test

.test-es6: &test-es6
  <<: *test-default
  services:
    - elasticsearch:6.4.2

.test-es5.6: &test-es56
  <<: *test-default
  services:
    - elasticsearch:5.6

test 1.7:
  <<: *test-es6
  image: golang:1.7

test 1.8:
  <<: *test-es6
  image: golang:1.8

test 1.9:
  <<: *test-es6
  image: golang:1.9

test 1.10:
  <<: *test-es6
  image: golang:1.10

test 1.7-es5.6:
  <<: *test-es56
  image: golang:1.7

test 1.8-es5.6:
  <<: *test-es56
  image: golang:1.8

test 1.9-es5.6:
  <<: *test-es56
  image: golang:1.9

test 1.10-es5.6:
  <<: *test-es56
  image: golang:1.10
